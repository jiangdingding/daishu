function Combox(a,b,c,d,e,f,g){var h=this;h.divId_=a,h.options=g||{},h.option_=c,h.textDiv_=h.options.textDivId||"t"+ +(new Date),h.listDiv_=h.options.listDivId||"l"+ +(new Date),h.inputName_=b,h.currentValue_=d,h.width_=e,h.height_=f,h.div_=$("#"+a),h.disible_=null,h.nodes_=[];if(!h.div_[0])return;h.initialize()}function initSearchBox(){var a={yt:[],zysf:[],mc_dkqx:[{value:36,text:"贷款3年"},{value:24,text:"贷款2年"},{value:12,text:"贷款1年"},{value:6,text:"贷款6个月"}],mf_dkqx:[{value:60,text:"5年"},{value:120,text:"10年"},{value:180,text:"15年"},{value:240,text:"20年"},{value:300,text:"25年"},{value:360,text:"30年"}],xf_dkqx:[{value:3,text:"3个月"},{value:6,text:"6个月"},{value:12,text:"12个月"},{value:24,text:"2年"},{value:36,text:"3年"},{value:60,text:"5年"},{value:120,text:"10年"}]};$.each(ytJson,function(b,c){a.yt.push({text:c.text,value:"t"+c.key})}),$.each(zysfJson,function(b,c){a.zysf.push({text:c,value:b})}),typeof defaultYt!="undefined"&&new Combox("yt","application_type",a.yt,defaultYt,113,30,{onchange:function(a,b){$("#"+b).hide(),$("#"+a).show(),typeof Validator!="undefined"&&Validator.clearHint(),$("#error_message").hide(),typeof onApplyTypeChange=="function"&&onApplyTypeChange(a,b)},oninit:function(a){$("#"+a).show()}}),$("#yt").length==0&&typeof defaultYt!="undefined"&&$("#"+defaultYt).length>0&&$("#"+defaultYt).show(),typeof defaultZysf!="undefined"&&new Combox("zysf","op_type",a.zysf,defaultZysf,113,30),typeof defaultXfZysf!="undefined"&&new Combox("xf_zysf","op_type",a.zysf,defaultXfZysf,113,30),typeof defaultZysf!="undefined"&&new Combox("qt_zysf","op_type",a.zysf,defaultZysf,113,30),typeof defaultMcDkqx!="undefined"&&new Combox("mc_dkqx","loan_term",a.mc_dkqx,defaultMcDkqx,113,30),typeof defaultMfDkqx!="undefined"&&new Combox("mf_dkqx","loan_term",a.mf_dkqx,defaultMfDkqx,113,30),typeof defaultZysf!="undefined"&&new Combox("zysf2","op_type",a.zysf,defaultZysf,113,30),typeof defaultXfZysf!="undefined"&&new Combox("xf_zysf2","op_type",a.zysf,defaultXfZysf,113,30),typeof defaultZysf!="undefined"&&new Combox("qt_zysf2","op_type",a.zysf,defaultZysf,113,30),typeof defaultMcDkqx!="undefined"&&new Combox("mc_dkqx2","loan_term",a.mc_dkqx,defaultMcDkqx,105,30,{dataTrack:"车贷方案选择|选择期限"}),typeof defaultMcDkqx!="undefined"&&new Combox("car_dkqx","loan_term",a.mc_dkqx,defaultMcDkqx,113,30,{dataTrack:"车贷方案选择|选择期限"}),$("#_bx_sb_loan_term").length&&new Combox("_bx_sb_loan_term","loan_term",a.xf_dkqx,defaultXfDkqx,113,30,{dataTrack:"不限类型选择|选择期限"}),$("#_xf_sb_loan_term").length&&new Combox("_xf_sb_loan_term","loan_term",a.xf_dkqx,defaultXfDkqx,113,30,{dataTrack:"消费方案选择|选择期限"}),$("#_jy_sb_loan_term").length&&new Combox("_jy_sb_loan_term","loan_term",a.xf_dkqx,defaultJyDkqx,113,30,{dataTrack:"经营方案选择|选择期限"}),$("#_qt_sb_loan_term").length&&new Combox("_qt_sb_loan_term","loan_term",a.xf_dkqx,defaultJyDkqx,113,30,{dataTrack:"经营方案选择|选择期限"}),typeof defaultCarDownPayment!="undefined"&&defaultCarDownPayment&&new Combox("car_dkcs","loan_limit",[{value:3,text:"首付3成"},{value:4,text:"首付4成"},{value:5,text:"首付5成"},{value:6,text:"首付6成"},{value:7,text:"首付7成"},{value:8,text:"首付8成"},{value:9,text:"首付9成"}],defaultCarDownPayment,113,30),typeof defaultMfDkqx!="undefined"&&new Combox("mf_dkqx2","loan_term",a.mf_dkqx,defaultMfDkqx,113,30)}function number_format(a,b,c,d){a=(a+"").replace(/[^0-9+\-Ee.]/g,"");var e=isFinite(+a)?+a:0,f=isFinite(+b)?Math.abs(b):0,g=typeof d=="undefined"?",":d,h=typeof c=="undefined"?".":c,i="",j=function(a,b){var c=Math.pow(10,b);return""+Math.round(a*c)/c};return i=(f?j(e,f):""+Math.round(e)).split("."),i[0].length>3&&(i[0]=i[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,g)),(i[1]||"").length<f&&(i[1]=i[1]||"",i[1]+=(new Array(f-i[1].length+1)).join("0")),i.join(h)}Combox.prototype.initialize=function(){var a,b=this,c=b.text_=$("<div></div>").addClass("yt-text").attr("id",b.textDiv_).height(b.height_-2).css("lineHeight",b.height_-2+"px").width(b.width_).click(function(c){c.stopPropagation(),a.toggle().children().removeClass("list-div-hover"),a.find('[ivalue="'+b.currentValue_+'"]').addClass("list-div-hover")});$.each(b.option_,function(a,d){d.value==b.currentValue_&&c.html(d.text)}),c.appendTo(this.div_),a=$("<div></div>").attr("panes","layer").attr("id",b.listDiv_).addClass("yt-list").css("top",b.height_-1).css("left",0).width(b.width_+8).hide(),a.appendTo(b.div_),$.each(b.option_,function(d,e){var f=$("<div></div>").attr("ivalue",e.value).width(b.width_-12).height(25).css("lineHeight","25px").css("cursor","pointer").html(e.text).hover(function(){$(this).toggleClass("item-on-hover")}).click(function(d){a.hide(),c.html($(this).html());var e=b.currentValue_;b.inp_.val(b.currentValue_=$(this).attr("ivalue")),b.options.onchange&&e!=b.currentValue_&&b.options.onchange(b.currentValue_,e)});b.currentValue_==e.value&&f.addClass("list-div-hover"),b.options.dataTrack&&f.attr("data-track",b.options.dataTrack+"|"+e.value),f.appendTo(a),b.nodes_.push(f)});var d=b.inp_=$('<input type="hidden" name="'+this.inputName_+'"/>').attr("id","_combox_inp_"+b.divId_).val(b.currentValue_);d.appendTo(b.div_),b.options.oninit&&b.options.oninit(b.currentValue_)},Combox.prototype.setValue=function(a){var b=this;$.each(b.nodes_,function(c,d){if(d.attr("ivalue")==a){b.text_.html(d.html());var e=b.currentValue_;b.inp_.val(b.currentValue_=a),b.options.onchange&&e!=b.currentValue_&&b.options.onchange(b.currentValue_,e)}})},function(){$("#yt")[0]?initSearchBox():$(initSearchBox)}();var template=function(a,b){var c=arguments.callee,d=c._cache=c._cache||{},e=c._conf=c._conf||{synxJS:{begin:"@!",end:"@"},synxTPL:{begin:"@@",end:"@"},synxVAR:{begin:"!@",end:"@"}},f=e.synxTPL.begin,g=e.synxTPL.end;c.synxBegin={each:function(a){var b=a.match(/^\s*(\S*)/)[1],c="$value";return"$.each("+b+", function($index,"+c+"){"},"if":"if ($1) {","else":"} else {"},c.synxEnd={each:"});","if":"};"};var h="var p=[];            with(obj){                p.push('"+a.replace(/[\r\t\n]/g," ").replace(new RegExp(e.synxVAR.begin+"(.+?)"+e.synxVAR.end,"g"),"',$1,'").replace(new RegExp(f+"([^\\/][^\\s"+g+"]*)(.*?)"+g,"ig"),function(a,b,d){var f=c.synxBegin[b];return e.synxJS.begin+(typeof f=="function"?f(d):f.replace("$1",d))+e.synxJS.end}).replace(new RegExp(f+"\\/(\\S*?)"+g,"ig"),function(a,b){return e.synxJS.begin+c.synxEnd[b]+e.synxJS.end}).replace(new RegExp(e.synxJS.begin+"(.+?)"+e.synxJS.end,"g"),"'); $1 p.push('")+"');        }        return p.join('');",i=d[a]=d[a]||new Function("obj",h);return b?i(b):i};(function(){var a='@@each data as $value@<div><div class="h2" id="!@$value.name@">!@$value.name@</div><ul flag="!@$index@">@@each $value.value as $value@<li flag="!@$index@">!@$value.name@<span class="num">(!@$value.value.length@)</span></li>@@/each@</ul></div>@@/each@',b='@@each data@<div><div class="h1"><span>!@$value.name@</span><span class="num">(!@$value.value.length@)</span></div><ul flag="!@$value.value.length@">@@each $value.value@<li flag="!@$index+1@"><input id="ct_!@$value.name@!@$index+1@" name="car" type="radio" value="!@$value.name@"/><label for="ct_!@$value.name@!@$index+1@">!@$value.value@</label> </li>@@/each@</ul></div>@@/each@',c='@@if (value)@<a href="#!@name@"><span>!@name@</span></a>@@else@<div><span>!@name@</span></div>@@/if@',d,e={},f={current:null,init:function(a){this.carForm=a,this.loadData(),this.inited||(this.addEvent(),this.inited=!0)},loadData:function(){var a=this;$.getJSON("/chedai/brandlist.html",function(b){d=b.data,$.each(d,function(a,b){e[b.name]=1}),a.setCate(d)})},addEvent:function(){var a=this;$("#car-index").click(function(a){var b=$(a.target);b.prop("tagName").toUperCase()!="A"&&(b=b.parent("a"));if(!b[0])return;var c=b.attr("href").match(/#(\w)$/),d;c&&(c=c[1])&&(d=$("#"+c)),c&&d&&$("#car-cates").parent().scrollTop(d.position().top-159),a.stopPropagation(),a.preventDefault()}),$("#car-cates").click(function(b){var c=b.target;c.tagName!="LI"&&(c=$(c).parent("li")[0]);if(!c)return;c=$(c),a.current.removeClass("hover"),c.addClass("hover"),a.current=c;var e=c.attr("flag"),f=c.parent().attr("flag");a.setBranch(d[f].value[e].value)})},chooseCar:function(){var a=this,b=a.getValue();return b?($("#car-name").html(b.name),this.carForm.car_model.value=b.value,this.carForm.car_brand.value=b.name,$("#car-name").show(),$("#choose-cars-btn").html("修改"),!0):!1},setCate:function(b){$("#car-cates").html(template(a,{data:b})),this.current=$("li","#car-cates"),this.current.addClass("hover"),this.setBranch(d[0].value[0].value),this.setIndex()},setBranch:function(a){$("#car-branches").html(template(b,{data:a})),$("input","#car-branches")[0].checked=!0,$("li","#car-branches").each(function(a,b){b=$(b);var c=b.attr("flag"),d=b.parent().attr("flag");c==d&&b.addClass("last")})},setIndex:function(){var a=[],b="ABCDEFGHIJKLMNOPQRSTUVWXYZ";$.each(b.split(""),function(b,d){var f={value:e[d],name:d};a.push(template(c,f))}),$("#car-index").html(a.join(""))},getValue:function(){var a;return $("input","#car-branches").each(function(b,c){c=$(c),c[0].checked&&(a={name:$("span",$("div",c.parent().parent().parent())).html()+" "+$("label",c.parent()).html(),value:c.val()})}),a}};window.chooseCar=f})(),function(){var a,b=$("#cal-form-dialog")[0],c=function(a){return/^[\d\.]+$/.test(a)},d={trans:{6:7.02,12:7.54,24:7.65,36:7.65,48:7.94,60:8.11},init:function(b,c){a=c||"#cal-form",a=$(a)[0],this.dialog=b,this.inited||(this.addEvent(),this.inited=!0),this._checkCheckBox(),this.setValue(),this.getResult(),this._checkMoney()},getValue:function(b){b=b||a;var c=parseFloat(b.money.value)||0,d=parseFloat(b.percent.value)||0,e=b.date,f=e.value;return{money:c,date:f,percent:d}},setValue:function(){var a=b.date,c=this.getValue();b.money.value=c.money||"",b.date.value=c.date||"",b.percent.value=c.percent||this.trans[c.date]},addEvent:function(){var a=this,c,d;$("#dialog-dates").click(function(c){var d=c.target;d.tagName=="INPUT"&&(b.percent.value=a.trans[d.value]||"")}),$(b.money).blur(function(b){a._checkMoney()}),$("#calculate-dialog").click(function(b){a._checkMoney()&&a.getResult(),b.stopPropagation(),b.preventDefault()});var e=$("#comp-result")[0];c=new ClickDescription(e,"每月按相等的金额偿还贷款本息，其中每月贷款利息按月初剩余贷款本金计算并逐月结清。作为还款人，每个月还给银行固定金额，但每月还款额中的本金比重逐月递增、利息比重逐月递减。这种方式付出的利息会更多，但是早期还款压力更小。",{left:-7,top:290,width:330,height:140}),$("#comp-result-hint1").click(function(a){c.toggle(),a.preventDefault(),a.stopPropagation()}),d=new ClickDescription(e,"将本金分摊到每个月内，同时付清上一交易日至本次还款日之间的利息。这种还款方式相对等额本息而言，总的利息支出较低，但是前期支付的本金和利息较多，还款负担逐月递减。 ",{left:259,top:290,width:330,height:120}),$("#comp-result-hint2").click(function(a){d.toggle(),a.preventDefault(),a.stopPropagation()})},_checkCheckBox:function(){var c=this,d=[{value:6,text:"6个月"},{value:12,text:"1年"},{value:24,text:"2年"},{value:36,text:"3年"},{value:48,text:"4年"},{value:60,text:"5年"}];$("#dialog-dates").html(""),new Combox("dialog-dates","date",d,a.date.value,113,29,{listDivId:"mc_dkqx_list3"}),$("#mc_dkqx_list3").mousedown(function(a){var d=a.target;return b.percent.value=c.trans[$(a.target).attr("ivalue")],!1})},_checkMoney:function(){var a=b.money,d=$(".err",$(a).parent().parent()),e=c(a.value);return d.toggle(!e),e},getResult:function(){var a=this.getValue(b),c,d,e,f,g=a.percent||this.trans[a.date],h=a.money*1e4,i=g/12/100,j=a.date*1;$("#comp-result").toggle(!!h),e={money:this.toNum(h),month:this.toNum(j),per:this.toNum(h*i*Math.pow(1+i,j)/(Math.pow(1+i,j)-1)),ext:this.toNum(h*j*i*Math.pow(1+i,j)/(Math.pow(1+i,j)-1)-h),total:this.toNum(h*j*i*Math.pow(1+i,j)/(Math.pow(1+i,j)-1))},f={money:this.toNum(h),month:this.toNum(j),per:this.toNum(h*(1+j*i)/j),perA:this.toNum(h*i/j),ext:this.toNum((j+1)*h*i/2),total:this.toNum(h+(j+1)*h*i/2)},$("#comp-result-type1").html(template(this.getTpl(1),e)),$("#comp-result-type2").html(template(this.getTpl(2),f))},toNum:function(a){return c(a)?(a=parseFloat(a),number_format(Math.round(a*1e3)/1e3,0,"",",")):""},getTpl:function(a){var b='<table cellspacing="0" cellpadding="0" class="tb"><tr><td class="first">贷款总额</td><td>!@money@ 元</td></tr><tr><td class="first">还款月数</td><td>!@month@ 月</td></tr><tr height="46px"><td class="first">'+(a==1?"每月还款":"首月还款")+"</td>"+'<td><span class="red">!@per@</span> 元'+(a==2?'<br/><span class="fade">月递减 !@perA@ 元</span>':"")+"</td></tr>"+"<tr>"+'<td class="first">总支付利息</td>'+'<td><span class="red">!@ext@</span> 元</td>'+"</tr>"+"<tr>"+'<td class="first">还款总额</td>'+'<td><span class="red">!@total@</span> 元</td>'+"</tr>"+"</table>";return b}};window.carComputer=d}();var widgetCar={init:function(a){function e(){var a=b[0].money,c=$(".err",$(a).parent().parent());return/^[\d\.]+$/.test(a.value)?(c.hide(),!0):(c.show(),!1)}function f(b,c){function g(a){var a=d[a],b=a.value;$(".err",$(a).parent("li")).toggle(!b),b||(e=!1)}function h(a){var b=d[a];$(b).blur(function(){g(a)})}var d=a,e=!0,f=["car_model","car_price","loan_limit"];return b?g(b):$.each(f,function(a,b){c?h(b):g(b)}),e}var b=$("#cal-form");b[0]&&$(b[0].money).blur(function(a){e()});var c=new PopLayer({trigger:"#calculate",target:"#comp-dialog",beforeOpen:function(){return e()?(carComputer.init(c),c.update(),!0):!1}}),d=new PopLayer({trigger:"#choose-cars-btn",target:"#choose-cars",beforeOpen:function(){return chooseCar.init(a),d.options.ok=function(){return chooseCar.chooseCar()},!0},afterClose:function(){f("car_model")}})}};$(function(){widgetCar.init($("#form_car")[0])})